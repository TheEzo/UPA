<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>UPA - projekt: probíhá import dat</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-lg-12 mt-5 text-center">
        <p class="h1 pb-2">UPA - projekt</p>
        <p role="alert" class="h4 alert alert-primary">Právě probíhá import a zpracování dat. Dokud nebude operace dokončena, nelze 
          provádět žádné akce.</p>
      </div>
    </div>

    <div class="row bg-secondary text-white" style="padding: 10pt 10pt;">
      <div class="col align-self-end" style="text-align: right; font-weight: bold;"> Konzole </div>
    </div>
    <div class="row bg-secondary text-white" style="min-height: 60vh; padding: 10pt 10pt;">
      <div class="col-lg-12" id="console">
      </div>
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
    crossorigin="anonymous"></script>

  <script type="text/javascript">
    function requestStatus() {
      $.post({
        url: '/status',
        dataType: "json",
        success: function (data, textStatus, jqXHR) {
          if (data['success'] === true) {
            $('#console').html(data['msg'].map(function (val) {
              return `<p>${val}</p>`
            }).join(''));
            setTimeout(requestStatus, 3000);
          }
          else {
            $('#console').html(`<p style="font-weight: bold; color: red;"> Při importu nastala chyba: </p> <p> ${data['msg']} </p> <p> Pro návrat zpět klikněte <a class="btn btn-primary" role="button" href="/dataloader">zde</a></p>`);
          }
        },
        error: function (jqXHR, textStatus, errorThrown) {
          if (jqXHR.status === 302) {
            //window.location.replace('/')
            $('#console').html('<p style="font-weight: bold; color: red;"> Import byl dokončen.</p>  <p> Pro přesměrování na visualizaci dat klikněte <a class="btn btn-primary" role="button" href="/">zde</a></p>');
          }
          else {
            const msg = `<p>Status code: ${jqXHR.status}</p> <p>Text status: ${textStatus}</p> <p>Error: ${errorThrown}</p>`;
            $('#console').html('<p style="font-weight: bold; color: red;"> Něco se pokazilo. Obnovte prosím stránku.</p>' + msg);
          }
        }
      });
    }

    $(document).ready(function () {
      requestStatus();
    });
  </script>

</body>

</html>